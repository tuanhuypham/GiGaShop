
@{
    ViewData["Title"] = "Detail Product";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="section padding_layout_1 product_detail">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <div class="row">
                    <div class="col-xl-6 col-lg-12 col-md-12">
                        <div class="product_detail_feature_img hizoom hi2">
                            <img id="product-image" src="" alt="Product Image" class="img-responsive"> <!-- Hình ảnh sản phẩm -->
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-12 col-md-12 product_detail_side detail_style1">
                        <p id="product-id">ID sản phẩm: <span></span></p>
                        <div class="product-heading">
                            <h2 id="product-name">Norton Internet Security</h2>
                        </div>
                        <div class="product-detail-side">
                            <p id="product-price"></p>
                            <div id="product-rating">Đánh giá sản phẩm sẽ được hiển thị ở đây</div>
                            <p id="product-specifications">Thông số kỹ thuật sẽ được hiển thị ở đây</p>
                        </div>
                        <div class="detail-contant">
                            <p id="product-description">Mô tả sản phẩm sẽ được hiển thị ở đây</p>
                            <form id="add-to-cart-form">
                                @Html.AntiForgeryToken()
                                <div class="quantity">
                                    <input id="quantity-input" step="1" min="1" max="5" name="quantity" value="1" title="Qty" class="input-text qty text" size="4" type="number">
                                </div>
                                <button type="button" id="add-to-cart-btn" class="btn sqaure_bt">Add to cart</button>
                            </form>
                        </div>
                        <div class="share-post">
                            <a href="#" class="share-text">Share</a>
                            <ul class="social_icons">
                                <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                                <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                                <li><a href="#"><i class="fa fa-google-plus" aria-hidden="true"></i></a></li>
                                <li><a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
                                <li><a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
                            </ul>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="full">
                            <div class="tab_bar_section">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item"> <a class="nav-link active" data-toggle="tab" href="#description">Description</a> </li>
                                    <li class="nav-item"> <a class="nav-link" data-toggle="tab" href="#reviews">Reviews (2)</a> </li>
                                </ul>
                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div id="description" class="tab-pane active">
                                        <div class="product_desc">
                                            <p>

                                            </p>
                                        </div>
                                    </div>
                                    <div id="reviews" class="tab-pane fade">
                                        <div class="product_review">
                                            <h3>Reviews (2)</h3>
                                            <div class="commant-text row">
                                                <div class="col-lg-2 col-md-2 col-sm-4">
                                                    <div class="profile"> <img class="img-responsive" src="images/it_service/client1.png" alt="#"> </div>
                                                </div>
                                                <div class="col-lg-10 col-md-10 col-sm-8">
                                                    <h5>David</h5>
                                                    <p><span class="c_date">March 2, 2018</span> | <span><a rel="nofollow" class="comment-reply-link" href="#">Reply</a></span></p>
                                                    <span class="rating"> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star-o" aria-hidden="true"></i> </span>
                                                    <p class="msg">
                                                        ThisThis book is a treatise on the theory of ethics, very popular during the Renaissance.
                                                        The first line of Lorem Ipsum, “Lorem ipsum dolor sit amet..
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="commant-text row">
                                                <div class="col-lg-2 col-md-2 col-sm-4">
                                                    <div class="profile"> <img class="img-responsive" src="images/it_service/client2.png" alt="#"> </div>
                                                </div>
                                                <div class="col-lg-10 col-md-10 col-sm-8">
                                                    <h5>Jack</h5>
                                                    <p><span class="c_date">March 2, 2018</span> | <span><a rel="nofollow" class="comment-reply-link" href="#">Reply</a></span></p>
                                                    <span class="rating"> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star-o" aria-hidden="true"></i> </span>
                                                    <p class="msg">Nunc augue purus, posuere in accumsan sodales ac, euismod at est. Nunc faccumsan ermentum consectetur metus placerat mattis. Praesent mollis justo felis, accumsan faucibus mi maximus et. Nam hendrerit mauris id scelerisque placerat. Nam vitae imperdiet turpis</p>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <div class="full review_bt_section">
                                                        <div class="float-right"> <a class="btn sqaure_bt" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">Leave a Review</a> </div>
                                                    </div>
                                                    <div class="full">
                                                        <div id="collapseExample" class="full collapse commant_box">
                                                            <form accept-charset="UTF-8" action="index.html" method="post">
                                                                <input id="ratings-hidden" name="rating" type="hidden">
                                                                <textarea class="form-control animated" cols="50" id="new-review" name="comment" placeholder="Enter your review here..." required=""></textarea>
                                                                <div class="full_bt center">
                                                                    <button class="btn sqaure_bt" type="submit">Save</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="side_bar">
                    <div class="side_bar_blog">
                        <h4>SEARCH</h4>
                        <div class="side_bar_search">
                            <div class="input-group stylish-input-group">
                                <input class="form-control" placeholder="Search" type="text">
                                <span class="input-group-addon">
                                    <button type="submit"><i class="fa fa-search" aria-hidden="true"></i></button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="side_bar_blog">
                        <h4>Báo giá</h4>
                        <p>Nhân viên thân thiện, dịch vụ uy tín - chất lượng - tiết kiệm, đảm bảo chính hãng. GigaShop sẽ hỗ trợ bạn!.</p>
                        <a class="btn sqaure_bt" href="@Url.Action("Service", "Home")">View Service</a>
                    </div>
                    <div class="side_bar_blog">
                        <h4>Dịch vụ</h4>
                        <div class="categary">
                            <ul>
                                <li><a href="it_data_recovery.html"><i class="fa fa-angle-right"></i> Sửa chữa</a></li>
                                <li><a href="it_computer_repair.html"><i class="fa fa-angle-right"></i> Lắp đặt</a></li>
                                <li><a href="it_mobile_service.html"><i class="fa fa-angle-right"></i> Bảo hành</a></li>
                                <li><a href="it_network_solution.html"><i class="fa fa-angle-right"></i> Bảo trì</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    window.onload = function () {
        const productId = localStorage.getItem('ProductID');
        if (productId) {
            // Gửi yêu cầu API để lấy thông tin sản phẩm với ProductID
            fetch(`/api/products/${productId}`)
                .then(response => response.json())
                .then(product => {
                    if (product) {
                        // Hiển thị thông tin chi tiết sản phẩm
                        document.getElementById('product-name').innerText = product.name || 'Không có tên sản phẩm';
                        document.getElementById('product-price').innerText = (product.price || 0) + ' VND';
                        document.getElementById('product-rating').innerHTML = getStarRating(product.rating || 0);
                        document.getElementById('product-description').innerText = product.description || 'Không có mô tả';
                        document.getElementById('product-specifications').innerText = product.specifications || 'Không có thông số kỹ thuật';

                        // Hiển thị ProductID
                        document.getElementById('product-id').querySelector('span').innerText = productId;

                        // Hiển thị hình ảnh sản phẩm dựa trên ProductID
                        displayProductImage(productId);
                    } else {
                        console.log('Không tìm thấy sản phẩm với ID: ' + productId);
                    }
                })
                .catch(error => {
                    console.error('Lỗi khi lấy dữ liệu sản phẩm:', error);
                });
        }
    };

    // Hàm hiển thị ảnh sản phẩm dựa trên ID
    function displayProductImage(productId) {
        // Gửi yêu cầu API để lấy danh sách ảnh
        fetch('/api/images/products')
            .then(response => response.json())
            .then(images => {
                // Đảm bảo ProductID luôn có 2 ký tự
                const formattedProductId = String(productId).padStart(2, '0');

                // Tìm ảnh có tên bắt đầu với 2 ký tự đầu của ProductID
                const matchedImage = images.find(image => image.startsWith(formattedProductId));

                // Đường dẫn mặc định nếu không tìm thấy ảnh
                const fallbackImage = '/images/default.jpg';

                // Nếu tìm thấy ảnh, hiển thị ảnh đó
                if (matchedImage) {
                    const imageElement = document.getElementById('product-image');
                    imageElement.src = `/images/Products/${matchedImage}`;  // Cập nhật đường dẫn ảnh
                    imageElement.alt = 'Product Image';  // Cập nhật alt text
                } else {
                    const imageElement = document.getElementById('product-image');
                    imageElement.src = fallbackImage;  // Nếu không tìm thấy, dùng ảnh mặc định
                    imageElement.alt = 'Default Product Image';  // Cập nhật alt text cho ảnh mặc định
                    console.log('Không tìm thấy ảnh cho sản phẩm này');
                }
            })
            .catch(error => {
                console.error('Lỗi khi lấy danh sách ảnh:', error);
            });
    }

    function getStarRating(rating) {
        let starsHtml = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= rating) {
                starsHtml += '<i class="fa fa-star" aria-hidden="true"></i>';
            } else {
                starsHtml += '<i class="fa fa-star-o" aria-hidden="true"></i>';
            }
        }
        return starsHtml;
    }
</script>
<script>
    document.getElementById('add-to-cart-btn').addEventListener('click', function () {
        const productId = document.getElementById('product-id').querySelector('span').innerText;
        const quantity = document.getElementById('quantity-input').value;
        body: JSON.stringify({
            productID: parseInt(productId), // Đảm bảo productId là số
            quantity: parseInt(quantity)   // Đảm bảo quantity là số
        })
        fetch('/api/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            },
            body: JSON.stringify({
                productID: parseInt(productId),
                quantity: parseInt(quantity)
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message); // Hiển thị thông báo thành công
                }
            })
            .catch(error => {
                console.error('Lỗi:', error);
                alert('Không thể thêm sản phẩm vào giỏ hàng. Vui lòng thử lại.');
            });
        

    });

</script>